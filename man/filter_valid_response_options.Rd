% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/filter_valid_response_options.R
\name{filter_valid_response_options}
\alias{filter_valid_response_options}
\title{Join Metadata and Filter Valid Survey Responses}
\usage{
filter_valid_response_options(
  pivoted_responses,
  varinfo,
  scale_options,
  exclude_responses = "Not applicable"
)
}
\arguments{
\item{pivoted_responses}{A tibble with one row per respondent per variable,
including \code{ITEM_NAME} and \code{response} columns (e.g., output from
\code{\link[=pivot_responses_longer]{pivot_responses_longer()}}).}

\item{varinfo}{A data frame that includes at least \code{ITEM_NAME} and \code{SCALE_OPTIONS}.}

\item{scale_options}{A data frame with one row per valid response option,
including columns \code{SCALE_OPTIONS_NAME}, \code{SCALE_OPTIONS_VALIDVALUES}, and
\code{INCLUDE}.}

\item{exclude_responses}{A character vector of response values to remove from
the data, even if they are not marked with \code{INCLUDE = FALSE}. Defaults to
\code{"Not applicable"}.}
}
\value{
A tibble containing only valid response rows, with \code{INCLUDE = FALSE}
and excluded responses removed.
}
\description{
Joins a long-format response-level data frame with item-level metadata from
\code{varinfo} and response-level metadata from \code{scale_options}. It then filters out
responses marked with \code{INCLUDE = FALSE} in \code{scale_options} and removes
responses listed in \code{exclude_responses}, such as \code{"Not applicable"}
}
\examples{
# attach required libraries
library(dplyr)

# Create a minimal response-level dataset
pivoted_responses <- tibble(
  rowid = 1:4,
  ITEM_NAME = c("q1", "q1", "q2", "q2", "q3"),
  response = c("Satisfied", "Did not participate", "Strongly agree", "Prefer not to say", "Not applicable")
)

# Create varinfo table mapping items to scale option sets
varinfo <- tibble(
  ITEM_NAME = c("q1", "q2", "q3"),
  SCALE_OPTIONS = c("satisfaction1", "agree2", "agree3")
)

# Create scale options metadata
scale_options <- tibble(
  SCALE_OPTIONS_NAME = c("satisfaction1", "satisfaction1", "agree2", "agree2", "agree3"),
  SCALE_OPTIONS_VALIDVALUES = c("Satisfied", "Did not participate", "Strongly agree", "Prefer not to say", "Not applicable"),
  INCLUDE = c(TRUE, FALSE, TRUE, TRUE, TRUE)
)

scale_filtered <- filter_valid_response_options(
   pivoted_responses = pivoted_by_response,
   varinfo = varinfo,
   scale_options = scale_options)

# or exclude additional responses
cleaned <- filter_valid_response_options(
  pivoted_by_response, varinfo, scale_options,
  exclude_responses = c("Not applicable","Prefer not to say"))

}
